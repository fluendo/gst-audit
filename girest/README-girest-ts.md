# girest-ts

TypeScript bindings generator for GIRest schemas.

## Overview

`girest-ts` is a command-line tool that generates TypeScript type definitions from GObject introspection data. It uses the GIRepository library to introspect GObject-based libraries and generates TypeScript interfaces and classes with proper inheritance and method signatures.

## Features

- **Automatic TypeScript generation**: Converts GObject introspection data to TypeScript
- **Inheritance support**: Properly handles `allOf` schemas and generates TypeScript interfaces with `extends`
- **Class methods**: Methods are organized by their tag (class name) and generated as class methods
- **Type safety**: All parameters and return types are properly typed
- **Enum support**: Enumerations are generated as string literal unions
- **Schema output**: Can also output the OpenAPI schema in JSON format

## Usage

### Basic Usage

Generate TypeScript bindings for a namespace:

```bash
python3 girest-ts.py <namespace> <version>
```

### Examples

Generate TypeScript bindings for GLib 2.0:

```bash
python3 girest-ts.py GLib 2.0 > glib.d.ts
```

Generate TypeScript bindings and save to a file:

```bash
python3 girest-ts.py GLib 2.0 -o glib.d.ts
```

Generate the OpenAPI schema instead of TypeScript:

```bash
python3 girest-ts.py GLib 2.0 --schema-only > glib-schema.json
```

### Command-line Options

```
usage: girest-ts.py [-h] [-o OUTPUT] [--schema-only] namespace version

positional arguments:
  namespace             GObject namespace (e.g., 'Gst', 'GLib', 'Gtk')
  version               Namespace version (e.g., '1.0', '2.0')

options:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        Output file path (default: stdout)
  --schema-only         Output OpenAPI schema JSON instead of TypeScript
```

## Generated TypeScript

The tool generates TypeScript definitions with the following structure:

### Interfaces

For each schema in the OpenAPI specification, a TypeScript interface is generated:

```typescript
export interface GLibDateTime {
  ptr: Pointer;
}
```

Interfaces with inheritance use `extends`:

```typescript
export interface GstElement extends GstObject {
  // Additional properties
}
```

### Classes

For schemas that have associated methods (identified by tags in the OpenAPI operations), a class is generated:

```typescript
export class GLibUnicodeScript {
  from_iso15924(iso15924: number): Promise<GLibUnicodeScript>;
  to_iso15924(script: GLibUnicodeScript): Promise<number>;
}
```

### Enums

Enumerations are generated as string literal unions:

```typescript
export interface GLibDateMonth {
}
```

## Requirements

- Python 3.10+
- PyGObject with GIRepository 2.0
- apispec

## Installation

No installation required. Just run the script directly:

```bash
cd /path/to/gst-audit/girest
python3 girest-ts.py <namespace> <version>
```

## How It Works

1. **Schema Generation**: Uses the `GIRest` class from `main.py` to generate an OpenAPI schema from GObject introspection data
2. **TypeScript Generation**: The `TypeScriptGenerator` class parses the OpenAPI schema and generates TypeScript definitions:
   - Schemas become interfaces
   - Operations are grouped by tags (class names)
   - Methods are generated for each class based on their tags
   - Inheritance is handled using `allOf` schemas
   - Types are converted from OpenAPI to TypeScript

## Limitations

- Currently generates type definitions only (no runtime implementation)
- Methods return `Promise` types but don't include actual implementation
- Complex callback types may need manual refinement
- Some advanced OpenAPI features may not be fully supported

## Examples

### Example Output

For GLib 2.0, the tool generates:

```typescript
/**
 * GLib REST API
 * Version: 2.0
 * Auto-generated by girest-ts
 */

export interface Pointer {
}

export interface GLibDateTime {
  ptr: Pointer;
}

export class GLibUnicodeScript {
  from_iso15924(iso15924: number): Promise<GLibUnicodeScript>;
  to_iso15924(script: GLibUnicodeScript): Promise<number>;
}
```

## See Also

- [GIRepository Documentation](https://gnome.pages.gitlab.gnome.org/gobject-introspection/girepository/)
- [OpenAPI Specification](https://swagger.io/specification/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/)
