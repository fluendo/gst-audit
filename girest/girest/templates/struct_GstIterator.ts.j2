{# GstIterator template - handles GstIterator with AsyncIterable interface #}
{% extends "struct.ts.j2" %}

{% block signature %}
export class {{ struct.name }} implements AsyncIterable<GObjectObject | null> {
{% endblock %}

{% block methods %}
  // Implement AsyncIterable interface
  [Symbol.asyncIterator](): AsyncIterator<GObjectObject | null, any, any> {
    let value: GObjectValue | null = null;
    
    return {
      next: async (): Promise<IteratorResult<GObjectObject | null>> => {
        // Initialize value lazily on first call
        if (!value) {
          value = await GObjectValue.new();
        }
        
        while (true) {
          await value.unset();
          const res = await this.next(value);
          
          switch (res) {
            case GstIteratorResult.DONE:
              return { done: true, value: undefined };
              
            case GstIteratorResult.OK:
              // Get the current value and return it
              const obj = await value.get_object();
              return { done: false, value: obj };
              
            case GstIteratorResult.RESYNC:
              // Iterator was modified, resync and continue
              await this.resync();
              break;
              
            case GstIteratorResult.ERROR:
              throw new Error('Iterator error');
          }
        }
      }
    };
  }

{{ super() }}
{% endblock %}
}
